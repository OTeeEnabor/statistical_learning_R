<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.3.450">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Oselu Enabor">
<meta name="dcterms.date" content="2024-10-14">

<title>Deep Dive into Linear Regression</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="c3_lab_linear_regression_files/libs/clipboard/clipboard.min.js"></script>
<script src="c3_lab_linear_regression_files/libs/quarto-html/quarto.js"></script>
<script src="c3_lab_linear_regression_files/libs/quarto-html/popper.min.js"></script>
<script src="c3_lab_linear_regression_files/libs/quarto-html/tippy.umd.min.js"></script>
<script src="c3_lab_linear_regression_files/libs/quarto-html/anchor.min.js"></script>
<link href="c3_lab_linear_regression_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="c3_lab_linear_regression_files/libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="c3_lab_linear_regression_files/libs/bootstrap/bootstrap.min.js"></script>
<link href="c3_lab_linear_regression_files/libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="c3_lab_linear_regression_files/libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">

  <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

</head>

<body>

<header id="title-block-header" class="quarto-title-block default page-columns page-full">
  <div class="quarto-title-banner page-columns page-full">
    <div class="quarto-title column-body">
      <h1 class="title">Deep Dive into Linear Regression</h1>
                      </div>
  </div>
    
  
  <div class="quarto-title-meta">

      <div>
      <div class="quarto-title-meta-heading">Author</div>
      <div class="quarto-title-meta-contents">
               <p>Oselu Enabor <a href="https://orcid.org/0000-0003-3813-2474" class="quarto-title-author-orcid"> <img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAA2ZpVFh0WE1MOmNvbS5hZG9iZS54bXAAAAAAADw/eHBhY2tldCBiZWdpbj0i77u/IiBpZD0iVzVNME1wQ2VoaUh6cmVTek5UY3prYzlkIj8+IDx4OnhtcG1ldGEgeG1sbnM6eD0iYWRvYmU6bnM6bWV0YS8iIHg6eG1wdGs9IkFkb2JlIFhNUCBDb3JlIDUuMC1jMDYwIDYxLjEzNDc3NywgMjAxMC8wMi8xMi0xNzozMjowMCAgICAgICAgIj4gPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4gPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIgeG1sbnM6eG1wTU09Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9tbS8iIHhtbG5zOnN0UmVmPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvc1R5cGUvUmVzb3VyY2VSZWYjIiB4bWxuczp4bXA9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC8iIHhtcE1NOk9yaWdpbmFsRG9jdW1lbnRJRD0ieG1wLmRpZDo1N0NEMjA4MDI1MjA2ODExOTk0QzkzNTEzRjZEQTg1NyIgeG1wTU06RG9jdW1lbnRJRD0ieG1wLmRpZDozM0NDOEJGNEZGNTcxMUUxODdBOEVCODg2RjdCQ0QwOSIgeG1wTU06SW5zdGFuY2VJRD0ieG1wLmlpZDozM0NDOEJGM0ZGNTcxMUUxODdBOEVCODg2RjdCQ0QwOSIgeG1wOkNyZWF0b3JUb29sPSJBZG9iZSBQaG90b3Nob3AgQ1M1IE1hY2ludG9zaCI+IDx4bXBNTTpEZXJpdmVkRnJvbSBzdFJlZjppbnN0YW5jZUlEPSJ4bXAuaWlkOkZDN0YxMTc0MDcyMDY4MTE5NUZFRDc5MUM2MUUwNEREIiBzdFJlZjpkb2N1bWVudElEPSJ4bXAuZGlkOjU3Q0QyMDgwMjUyMDY4MTE5OTRDOTM1MTNGNkRBODU3Ii8+IDwvcmRmOkRlc2NyaXB0aW9uPiA8L3JkZjpSREY+IDwveDp4bXBtZXRhPiA8P3hwYWNrZXQgZW5kPSJyIj8+84NovQAAAR1JREFUeNpiZEADy85ZJgCpeCB2QJM6AMQLo4yOL0AWZETSqACk1gOxAQN+cAGIA4EGPQBxmJA0nwdpjjQ8xqArmczw5tMHXAaALDgP1QMxAGqzAAPxQACqh4ER6uf5MBlkm0X4EGayMfMw/Pr7Bd2gRBZogMFBrv01hisv5jLsv9nLAPIOMnjy8RDDyYctyAbFM2EJbRQw+aAWw/LzVgx7b+cwCHKqMhjJFCBLOzAR6+lXX84xnHjYyqAo5IUizkRCwIENQQckGSDGY4TVgAPEaraQr2a4/24bSuoExcJCfAEJihXkWDj3ZAKy9EJGaEo8T0QSxkjSwORsCAuDQCD+QILmD1A9kECEZgxDaEZhICIzGcIyEyOl2RkgwAAhkmC+eAm0TAAAAABJRU5ErkJggg=="></a></p>
            </div>
    </div>
      
      <div>
      <div class="quarto-title-meta-heading">Published</div>
      <div class="quarto-title-meta-contents">
        <p class="date">2024-10-14</p>
      </div>
    </div>
    
      
    </div>
    
  
  </header><div id="quarto-content" class="page-columns page-rows-contents page-layout-article">
<div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
  <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#simple-linear-regression" id="toc-simple-linear-regression" class="nav-link active" data-scroll-target="#simple-linear-regression"><span class="header-section-number">1</span> Simple Linear Regression</a>
  <ul class="collapse">
  <li><a href="#assessing-the-accuracy-of-the-coefficient-estimates" id="toc-assessing-the-accuracy-of-the-coefficient-estimates" class="nav-link" data-scroll-target="#assessing-the-accuracy-of-the-coefficient-estimates"><span class="header-section-number">1.1</span> Assessing the Accuracy of the coefficient estimates</a>
  <ul class="collapse">
  <li><a href="#hypothesis-test" id="toc-hypothesis-test" class="nav-link" data-scroll-target="#hypothesis-test"><span class="header-section-number">1.1.1</span> Hypothesis test</a></li>
  </ul></li>
  <li><a href="#assessing-the-models-accuracy" id="toc-assessing-the-models-accuracy" class="nav-link" data-scroll-target="#assessing-the-models-accuracy"><span class="header-section-number">1.2</span> Assessing the modelâ€™s accuracy</a>
  <ul class="collapse">
  <li><a href="#residual-standard-error-rse" id="toc-residual-standard-error-rse" class="nav-link" data-scroll-target="#residual-standard-error-rse"><span class="header-section-number">1.2.1</span> Residual Standard Error (RSE)</a></li>
  <li><a href="#r2" id="toc-r2" class="nav-link" data-scroll-target="#r2"><span class="header-section-number">1.2.2</span> <span class="math inline">\(R^2\)</span></a></li>
  </ul></li>
  </ul></li>
  <li><a href="#multiple-linear-regression" id="toc-multiple-linear-regression" class="nav-link" data-scroll-target="#multiple-linear-regression"><span class="header-section-number">2</span> Multiple Linear Regression</a>
  <ul class="collapse">
  <li><a href="#estimating-regression-coefficients" id="toc-estimating-regression-coefficients" class="nav-link" data-scroll-target="#estimating-regression-coefficients"><span class="header-section-number">2.1</span> Estimating Regression Coefficients</a></li>
  <li><a href="#important-considerations-for-multiple-linear-regression" id="toc-important-considerations-for-multiple-linear-regression" class="nav-link" data-scroll-target="#important-considerations-for-multiple-linear-regression"><span class="header-section-number">2.2</span> Important Considerations for Multiple Linear Regression</a>
  <ul class="collapse">
  <li><a href="#is-there-a-relationship-between-response-and-predictors" id="toc-is-there-a-relationship-between-response-and-predictors" class="nav-link" data-scroll-target="#is-there-a-relationship-between-response-and-predictors"><span class="header-section-number">2.2.1</span> Is there a relationship between response and predictors?</a></li>
  <li><a href="#feature-selection---deciding-on-important-variables" id="toc-feature-selection---deciding-on-important-variables" class="nav-link" data-scroll-target="#feature-selection---deciding-on-important-variables"><span class="header-section-number">2.2.2</span> Feature Selection - deciding on important variables</a></li>
  <li><a href="#model-fit" id="toc-model-fit" class="nav-link" data-scroll-target="#model-fit"><span class="header-section-number">2.2.3</span> Model Fit</a></li>
  <li><a href="#predictions" id="toc-predictions" class="nav-link" data-scroll-target="#predictions"><span class="header-section-number">2.2.4</span> Predictions</a></li>
  </ul></li>
  <li><a href="#other-considerations-in-regression-model" id="toc-other-considerations-in-regression-model" class="nav-link" data-scroll-target="#other-considerations-in-regression-model"><span class="header-section-number">2.3</span> Other considerations in Regression Model</a>
  <ul class="collapse">
  <li><a href="#qualitative-predictors" id="toc-qualitative-predictors" class="nav-link" data-scroll-target="#qualitative-predictors"><span class="header-section-number">2.3.1</span> Qualitative predictors</a></li>
  <li><a href="#extensions-of-linear-model" id="toc-extensions-of-linear-model" class="nav-link" data-scroll-target="#extensions-of-linear-model"><span class="header-section-number">2.3.2</span> Extensions of Linear Model</a></li>
  </ul></li>
  </ul></li>
  </ul>
</nav>
</div>
<main class="content quarto-banner-title-block" id="quarto-document-content">




<section id="simple-linear-regression" class="level1" data-number="1">
<h1 data-number="1"><span class="header-section-number">1</span> Simple Linear Regression</h1>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">install.packages</span>(<span class="st">"metR"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ISLR)</span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ISLR2)</span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(metR)</span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a><span class="co">#library(plotly)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>This notebook is a follow-along of the ISLR 2 textbook.</p>
<p><em>Simple linear regression</em> is a simple approach to predicting a quantitative respnse <code>Y</code> using a single predictor variable <code>X</code>. The linearity between the two variables is the fundamental assumption of SLR. Mathematically,</p>
<p><span class="math display">\[Y \approx \beta_{0} + \beta_{1}X\]</span></p>
<p>The equation above can be read as the regressing of Y on X or (Y onto X).</p>
<p><strong>practical example</strong> In a software distribution company, Y can represent sales of a product T, while X can rerpresent advertising spend through TV channel.</p>
<p><span class="math display">\[sales \approx \beta_{0} + \beta_{1}\times TV_{advertisingspend}\]</span> <span class="math inline">\(\beta_{0} \; and \; \beta_{1}\)</span> are unknown parameters and represent the intercept and slope terms in the linear model. They are the modelâ€™s coefficient parameters. They are estimated by fitting the model with data. After estimating these parameters, the future sales of Product T can be predicted using TV advertising spend.</p>
<p><span class="math display">\[\hat{y} = \hat{\beta_{0}} + \hat{\beta_{1}}X \]</span> The <span class="math inline">\(\hat{}\)</span> symbol represents that this is an estimated value for an unknown parameter or coefficient.</p>
<p>The Advertising data set is used in this example - the data set consists of TV advertising budget and product sales in <span class="math inline">\(n=200\)</span> different markets.</p>
<p><strong>Goal</strong>: obtain coefficient estimates of <span class="math inline">\(\hat{\beta_{0}} \text{ and } \hat{\beta_{1}}\)</span> such that our linear model fits the available data well - i.e.&nbsp;the values such that the resulting line is as closes as possible to the 200 data points. The minimizing least squares criterion will be used to measure closeness.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="co"># read in the Advertising data set</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>advertising <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="st">"../data/Advertising.csv"</span>)</span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(advertising)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>  X    TV radio newspaper sales
1 1 230.1  37.8      69.2  22.1
2 2  44.5  39.3      45.1  10.4
3 3  17.2  45.9      69.3   9.3
4 4 151.5  41.3      58.5  18.5
5 5 180.8  10.8      58.4  12.9
6 6   8.7  48.9      75.0   7.2</code></pre>
</div>
</div>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="co"># attach Advertising to GlobalEnv</span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a><span class="fu">attach</span>(advertising)</span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a><span class="co"># fit a linear model</span></span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a>model <span class="ot">&lt;-</span> <span class="fu">lm</span>(sales <span class="sc">~</span>TV)</span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a><span class="co"># create scatter plot sales vs tv</span></span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(TV,sales, <span class="at">col=</span><span class="st">"red"</span>, <span class="at">pch=</span><span class="dv">20</span>)</span>
<span id="cb5-8"><a href="#cb5-8" aria-hidden="true" tabindex="-1"></a><span class="co"># add regression line</span></span>
<span id="cb5-9"><a href="#cb5-9" aria-hidden="true" tabindex="-1"></a><span class="fu">abline</span>(model, <span class="at">col=</span><span class="st">"blue"</span>, <span class="at">lwd=</span><span class="dv">2</span>)</span>
<span id="cb5-10"><a href="#cb5-10" aria-hidden="true" tabindex="-1"></a><span class="co"># add residuals as segments</span></span>
<span id="cb5-11"><a href="#cb5-11" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">nrow</span>(advertising)){</span>
<span id="cb5-12"><a href="#cb5-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">segments</span>(TV[i], sales[i], TV[i], <span class="fu">fitted</span>(model)[i], <span class="at">col=</span><span class="st">"gray"</span>, <span class="at">lty=</span><span class="dv">2</span>)</span>
<span id="cb5-13"><a href="#cb5-13" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="c3_lab_linear_regression_files/figure-html/unnamed-chunk-4-1.png" class="img-fluid" width="768"></p>
</div>
</div>
<p>The plot above shows the following:</p>
<ol type="1">
<li><p>Red dots represent the relationship between Sales and TV spend budget. From the plot, we see a positive correlation between the two variables. That is as the advertising spend increases so does the sales generated.</p></li>
<li><p>Blue line represents the least squares regression line that is closes to all the points on the graph. The model coefficient estimates are shown below.</p></li>
</ol>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="fu">coefficients</span>(model)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>(Intercept)          TV 
 7.03259355  0.04753664 </code></pre>
</div>
</div>
<ol start="3" type="1">
<li>Grey lines represent the difference between the actual values of sales and the regression modelâ€™s predicted value for each advertising spend.</li>
</ol>
<p><strong>Plot contour</strong></p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="co"># create a grid of values for beta_0 and beta_1</span></span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>beta_0_seq <span class="ot">&lt;-</span> <span class="fu">seq</span>(<span class="fl">0.0</span>, <span class="fl">0.1</span>,<span class="at">length.out=</span><span class="dv">10</span>)</span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a>beta_1_seq <span class="ot">&lt;-</span> <span class="fu">seq</span>(<span class="dv">5</span>,<span class="dv">10</span>,<span class="at">length.out=</span><span class="dv">10</span>)</span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a><span class="co"># create grid</span></span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a>coeff_grid <span class="ot">&lt;-</span> <span class="fu">expand.grid</span>(<span class="at">x1=</span>beta_0_seq, <span class="at">x2=</span>beta_1_seq)</span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb8-7"><a href="#cb8-7" aria-hidden="true" tabindex="-1"></a><span class="co">#contour(coeff_grid)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<section id="assessing-the-accuracy-of-the-coefficient-estimates" class="level2" data-number="1.1">
<h2 data-number="1.1" class="anchored" data-anchor-id="assessing-the-accuracy-of-the-coefficient-estimates"><span class="header-section-number">1.1</span> Assessing the Accuracy of the coefficient estimates</h2>
<p>Population Regression Line</p>
<p>Remember a linear regression (if fact any model) is an estimator of the <code>true function</code> that captures the relationship between X and Y. In real data situations, the true relationship is usually not know, so the least squares line can be used to estimate the coefficient of the model.</p>
<p>Think of it as the notion of samples and populations from statistics - we are using a sample estimate to characterize the relationship of the population.</p>
<p>This true relationship can be represented as <span class="math display">\[Y = f(X) + \epsilon\]</span> <span class="math display">\[Y = \beta_{0} + \beta_{1}X + \epsilon\]</span> <span class="math inline">\(\beta_{1}\)</span> is the slope and intuitively - <strong>average increase in Y associated with one-unit increase in X</strong>.</p>
<p><span class="math inline">\(\epsilon\)</span> represents the random error (mean=0) present</p>
<p>The <code>standard error</code>, <code>SE</code>, is used to determine how accurate is a sample estimate of a population parameter. This statistic gives an indication of the average amount an estimate differs from the true value.</p>
<p><span class="math display">\[Var(\hat{\mu}) = SE(\hat{\mu})^2 = \frac{\sigma^2}{n}\]</span></p>
<p>Where: <span class="math inline">\(\sigma\)</span> standard deviation of the predictions of Y. <span class="math inline">\(\sigma^2 = Var(\epsilon)\)</span></p>
<p>The formula holds for independent observations and residuals have a common variance. From the equation above, the more observations we have,the smaller the standard error of estimate mean.</p>
<p><span class="math display">\[SE(\hat{\beta_0})^2 = \sigma^2[\frac{1}{n} + \frac{\bar{x}}{\Sigma_{i=1}^{n} (x_{i} - \bar{x})^2}]\]</span></p>
<p><span class="math display">\[SE(\hat{\beta_1})^2 =  \frac{\sigma^2}{\Sigma_{i=1}^{n} (x_{i} - \bar{x})^2}\]</span></p>
<p>Unfortunately, <span class="math inline">\(\sigma^2\)</span> is not known but can be estimated from available data.This estimate is known as the residual standard error, <span class="math inline">\(RSE = \sqrt{RSS/(n-2)}\)</span>.</p>
<p>SE can be used to calculate the confidence intervals and prediction intervals.</p>
<p>A confidence interval is defined as the range of values which ill contain the true unknown value of the parameter.</p>
<p>An <code>x%</code> confidence interval means that the true value of this estimator will lie in this range with an <code>%</code> probability. This range is computed with the lower and upper limits computed from the sample data. A 95% confidence interval: - if take repreated samples from data and construct confiddence interval for each sample, 95% of the intervals will contain the true unknown value of the parameter.</p>
<p>For <em>linear regression</em>, 95% confidence for <span class="math inline">\(\beta_{1}\)</span> is <span class="math display">\[\hat{\beta_1} \pm 2 \times SE(\hat{\beta_1}) \]</span> This holds true for <span class="math inline">\(\beta_{0}\)</span>.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(model)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
lm(formula = sales ~ TV)

Residuals:
    Min      1Q  Median      3Q     Max 
-8.3860 -1.9545 -0.1913  2.0671  7.2124 

Coefficients:
            Estimate Std. Error t value Pr(&gt;|t|)    
(Intercept) 7.032594   0.457843   15.36   &lt;2e-16 ***
TV          0.047537   0.002691   17.67   &lt;2e-16 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Residual standard error: 3.259 on 198 degrees of freedom
Multiple R-squared:  0.6119,    Adjusted R-squared:  0.6099 
F-statistic: 312.1 on 1 and 198 DF,  p-value: &lt; 2.2e-16</code></pre>
</div>
</div>
<p>From the model summary information above, an increase of $1000 in TV advertising budget is <strong>associated</strong> with an increase of around 48 unit sales.</p>
<section id="hypothesis-test" class="level3" data-number="1.1.1">
<h3 data-number="1.1.1" class="anchored" data-anchor-id="hypothesis-test"><span class="header-section-number">1.1.1</span> Hypothesis test</h3>
<p>Here we are testing the association of TV budget and unit sales.</p>
<p>Null hypothesis <span class="math inline">\(H_{0}\)</span>: <strong>No relationship between sales and TV advertising budget</strong> <span class="math display">\[H_{0}: \beta_{1} = 0\]</span> Alternative hypothesis <span class="math inline">\(H_{a}\)</span>: <strong>There is a relationship between X and Y</strong> <span class="math display">\[H_{a}: \beta_{1} \neq 0\]</span> The hypothesis tests determines how far the sample estimate <span class="math inline">\(\hat\beta_{1}\)</span> is from zero, the further it is away, the more confident we are of the existence of a relationship between X and Y. <strong>How far is far enough?</strong> - This depends on the accuracy of <span class="math inline">\(\hat{\beta_{1}}\)</span>, i.e.&nbsp;- the standard error (SE<span class="math inline">\(\hat{\beta_{1}}\)</span>) - if small, then relatively small values of $ $<strong>may provide</strong> strong evidence that <span class="math inline">\(\beta_{1} \neq 0\)</span>. <strong>However</strong>, if SE(<span class="math inline">\(\hat{\beta_{1}}\)</span>) is large, then <span class="math inline">\(\hat{\beta_{1}}\)</span> must be large in absolute value in order to reject the null hypothesis. In practice, the t-statistic is calculated. To do this, we calculate a <em>t-statistic</em> <span class="math display">\[t = \frac{\hat{\beta_1}-0}{SE(\hat{\beta_1})}\]</span> Once <em>t-statistic</em> is calculated, use the p-value to determine if the t-statistic is valid or due to random chance.</p>
<p><strong>A small p-value indicates the unlikelihood of observing a substantial association (<span class="math inline">\(\beta_{1}\)</span>) between the predictor and response due to chance, in the absence of any real association between the predictor and the response. or mathematically</strong> <span class="math display">\[P(t | \beta_{1})=0
\]</span></p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="co"># calculate RSS</span></span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a>calc_RSS <span class="ot">&lt;-</span> <span class="cf">function</span>(beta0,beta1, data){</span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a>  <span class="co"># get predicted sales based on TV advertising</span></span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a>  predicted_sales <span class="ot">&lt;-</span> beta0 <span class="sc">+</span> beta1 <span class="sc">*</span>data<span class="sc">$</span>TV</span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a>  <span class="co"># calculate RSS</span></span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true" tabindex="-1"></a>  rss <span class="ot">&lt;-</span>  <span class="fu">sum</span>((data<span class="sc">$</span>sales <span class="sc">-</span> predicted_sales)<span class="sc">^</span><span class="dv">2</span>)</span>
<span id="cb11-7"><a href="#cb11-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span> (rss)</span>
<span id="cb11-8"><a href="#cb11-8" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="co"># create a grid of beta9 and beta1</span></span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a>beta0_seq <span class="ot">&lt;-</span> <span class="fu">seq</span>(<span class="sc">-</span><span class="dv">10</span>,<span class="dv">10</span>, <span class="at">length.out  =</span><span class="dv">100</span>)</span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a>beta1_seq <span class="ot">&lt;-</span> <span class="fu">seq</span>(<span class="sc">-</span><span class="fl">0.1</span>,<span class="fl">0.1</span>, <span class="at">length.out =</span> <span class="dv">100</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="co"># create RSS matrix grid</span></span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a>rss_matrix <span class="ot">&lt;-</span> <span class="fu">outer</span>(beta0_seq, beta1_seq, <span class="fu">Vectorize</span>(<span class="cf">function</span>(b0,b1) <span class="fu">calc_RSS</span>(b0,b1,advertising)))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="co"># convert to data frame</span></span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a>rss_df <span class="ot">&lt;-</span> <span class="fu">expand.grid</span>(<span class="at">Beta0=</span>beta0_seq, <span class="at">Beta1=</span>beta1_seq)</span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a>rss_df<span class="sc">$</span>RSS <span class="ot">&lt;-</span> <span class="fu">as.vector</span>(rss_matrix)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(rss_df, <span class="fu">aes</span>(<span class="at">x=</span>Beta0, <span class="at">y=</span>Beta1)) <span class="sc">+</span></span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_contour</span>(<span class="fu">aes</span>(<span class="at">z=</span>rss_df<span class="sc">$</span>RSS), <span class="at">color=</span><span class="st">"blue"</span>) <span class="sc">+</span></span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_text_contour</span>(<span class="fu">aes</span>(<span class="at">z=</span>RSS), <span class="at">color=</span><span class="st">"red"</span>, <span class="at">size=</span><span class="dv">3</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="c3_lab_linear_regression_files/figure-html/unnamed-chunk-12-1.png" class="img-fluid" width="768"></p>
</div>
</div>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="co">#rss &lt;- outer(beta0_seq, beta1_seq, function(b0, b1) calc_RSS(b0, b1, advertising))</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
</section>
<section id="assessing-the-models-accuracy" class="level2" data-number="1.2">
<h2 data-number="1.2" class="anchored" data-anchor-id="assessing-the-models-accuracy"><span class="header-section-number">1.2</span> Assessing the modelâ€™s accuracy</h2>
<p>Quality of a linear regression fit is assessed with two related quantities - <em>residual standard error</em> (RSE) -<span class="math inline">\(R^2\)</span></p>
<section id="residual-standard-error-rse" class="level3" data-number="1.2.1">
<h3 data-number="1.2.1" class="anchored" data-anchor-id="residual-standard-error-rse"><span class="header-section-number">1.2.1</span> Residual Standard Error (RSE)</h3>
<p>The RSE is an estimate of the standard deviation of <span class="math inline">\(\epsilon\)</span> - the average amount that the response will deviate from the <strong>true regression line</strong>. <span class="math display">\[RSE = \sqrt{\frac{1}{n-2}*RSS} = \sqrt{\frac{1}{n-2}* \Sigma^{n}_{i=1}(y_{i} - \hat{y_{i}})^2}\]</span></p>
<p>RSE is considered the measure of <em>lack of fit</em> of the model to the data. If the modelâ€™s prediction are close the the true outcome values - then RSE will be small and can conclude model fits data well - and <strong>vice versa</strong>.</p>
</section>
<section id="r2" class="level3" data-number="1.2.2">
<h3 data-number="1.2.2" class="anchored" data-anchor-id="r2"><span class="header-section-number">1.2.2</span> <span class="math inline">\(R^2\)</span></h3>
<p><span class="math inline">\(R^2\)</span> is a measurement of proportion between 0 and 1 - and it is independent of the scale of Y. <span class="math display">\[R^{2} = \frac{TSS - RSS}{TSS} = 1 - \frac{RSS}{TSS}\]</span> <strong>TSS</strong> measures the <strong>total variance</strong> in the response <strong>Y</strong> - inherent variability in the response variable before regression is performed.</p>
<p><strong>RSS</strong> measures the amount of variability that is left unexplained after performing the regression.</p>
<p><strong>R^2</strong> measures the <em>proportion of variability</em> in Y that can be explained using X.</p>
</section>
</section>
</section>
<section id="multiple-linear-regression" class="level1" data-number="2">
<h1 data-number="2"><span class="header-section-number">2</span> Multiple Linear Regression</h1>
<p>Multiple Linear Regression is more often used than simple linear as in practice we have more than one predictor. For example in the <strong>Advertising</strong> data, we examined only the relationship between <em>sales</em> and <em>TV advertising</em>. However, we have <em>radio spend</em> and <em>newspaper spend</em> available. Are any of the two associated with sales?</p>
<p>Three simple linear regression models could be created - with each advertising medium used as a predictor.</p>
<p>Sales and Radio Advertising</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="co"># fit a linear model</span></span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a><span class="fu">attach</span>(advertising)</span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a>model_radio <span class="ot">&lt;-</span> <span class="fu">lm</span>(sales <span class="sc">~</span>radio)</span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-5"><a href="#cb17-5" aria-hidden="true" tabindex="-1"></a><span class="co"># create scatter plot sales vs tv</span></span>
<span id="cb17-6"><a href="#cb17-6" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(radio,sales, <span class="at">col=</span><span class="st">"red"</span>, <span class="at">pch=</span><span class="dv">20</span>)</span>
<span id="cb17-7"><a href="#cb17-7" aria-hidden="true" tabindex="-1"></a><span class="co"># add regression line</span></span>
<span id="cb17-8"><a href="#cb17-8" aria-hidden="true" tabindex="-1"></a><span class="fu">abline</span>(model_radio, <span class="at">col=</span><span class="st">"blue"</span>, <span class="at">lwd=</span><span class="dv">2</span>)</span>
<span id="cb17-9"><a href="#cb17-9" aria-hidden="true" tabindex="-1"></a><span class="co"># add residuals as segments</span></span>
<span id="cb17-10"><a href="#cb17-10" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">nrow</span>(advertising)){</span>
<span id="cb17-11"><a href="#cb17-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">segments</span>(radio[i], sales[i], radio[i], <span class="fu">fitted</span>(model_radio)[i], <span class="at">col=</span><span class="st">"gray"</span>, <span class="at">lty=</span><span class="dv">2</span>)</span>
<span id="cb17-12"><a href="#cb17-12" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="c3_lab_linear_regression_files/figure-html/unnamed-chunk-14-1.png" class="img-fluid" width="768"></p>
</div>
</div>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(model_radio)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
lm(formula = sales ~ radio)

Residuals:
     Min       1Q   Median       3Q      Max 
-15.7305  -2.1324   0.7707   2.7775   8.1810 

Coefficients:
            Estimate Std. Error t value Pr(&gt;|t|)    
(Intercept)  9.31164    0.56290  16.542   &lt;2e-16 ***
radio        0.20250    0.02041   9.921   &lt;2e-16 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Residual standard error: 4.275 on 198 degrees of freedom
Multiple R-squared:  0.332, Adjusted R-squared:  0.3287 
F-statistic: 98.42 on 1 and 198 DF,  p-value: &lt; 2.2e-16</code></pre>
</div>
</div>
<p>Sales and Newspaper advertising</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a><span class="co"># fit a linear model</span></span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a><span class="fu">attach</span>(advertising)</span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a>model_news <span class="ot">&lt;-</span> <span class="fu">lm</span>(sales <span class="sc">~</span>newspaper)</span>
<span id="cb20-4"><a href="#cb20-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-5"><a href="#cb20-5" aria-hidden="true" tabindex="-1"></a><span class="co"># create scatter plot sales vs tv</span></span>
<span id="cb20-6"><a href="#cb20-6" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(newspaper,sales, <span class="at">col=</span><span class="st">"red"</span>, <span class="at">pch=</span><span class="dv">20</span>)</span>
<span id="cb20-7"><a href="#cb20-7" aria-hidden="true" tabindex="-1"></a><span class="co"># add regression line</span></span>
<span id="cb20-8"><a href="#cb20-8" aria-hidden="true" tabindex="-1"></a><span class="fu">abline</span>(model_news, <span class="at">col=</span><span class="st">"blue"</span>, <span class="at">lwd=</span><span class="dv">2</span>)</span>
<span id="cb20-9"><a href="#cb20-9" aria-hidden="true" tabindex="-1"></a><span class="co"># add residuals as segments</span></span>
<span id="cb20-10"><a href="#cb20-10" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">nrow</span>(advertising)){</span>
<span id="cb20-11"><a href="#cb20-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">segments</span>(newspaper[i], sales[i], newspaper[i], <span class="fu">fitted</span>(model_news)[i], <span class="at">col=</span><span class="st">"gray"</span>, <span class="at">lty=</span><span class="dv">2</span>)</span>
<span id="cb20-12"><a href="#cb20-12" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="c3_lab_linear_regression_files/figure-html/unnamed-chunk-16-1.png" class="img-fluid" width="768"></p>
</div>
</div>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(model_news)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
lm(formula = sales ~ newspaper)

Residuals:
     Min       1Q   Median       3Q      Max 
-11.2272  -3.3873  -0.8392   3.5059  12.7751 

Coefficients:
            Estimate Std. Error t value Pr(&gt;|t|)    
(Intercept) 12.35141    0.62142   19.88  &lt; 2e-16 ***
newspaper    0.05469    0.01658    3.30  0.00115 ** 
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Residual standard error: 5.092 on 198 degrees of freedom
Multiple R-squared:  0.05212,   Adjusted R-squared:  0.04733 
F-statistic: 10.89 on 1 and 198 DF,  p-value: 0.001148</code></pre>
</div>
</div>
<p>Rather than fitting a separate simple linear regression model for each predictor - we can extend the model and have a coefficient for each predictor. For <em>p</em> distinct predictors, the simple linear regression model would look like <span class="math display">\[Y = \beta_{0} + \beta_{1}X_{1} + \beta_{2}X_{2} + ... + \beta_{p}X_{p} + \epsilon\]</span> where: <span class="math inline">\(X_j\)</span> represents the <span class="math inline">\(j_{th}\)</span> variable</p>
<p><span class="math inline">\(\beta_{j}\)</span> represents the association between variable <em>j</em> and the response Y. This is interpreted as the <em>average</em> effect on Y of a one unit increase in <span class="math inline">\(X_j\)</span>, holding all other predictors fixed.</p>
<p>The advertising problem would then look like <span class="math display">\[sales = \beta_{0} + \beta_{1} \times TV + \beta_{2} \times radio + \beta_{3} \times newspaper + \epsilon\]</span></p>
<section id="estimating-regression-coefficients" class="level2" data-number="2.1">
<h2 data-number="2.1" class="anchored" data-anchor-id="estimating-regression-coefficients"><span class="header-section-number">2.1</span> Estimating Regression Coefficients</h2>
<p>Predictions can made if the coefficients for each independent variable is known. <span class="math display">\[\hat{y} = \hat{\beta_{0}} + \hat{\beta_{1}X_{1}} + \hat{\beta_{2}X_{2}} + ... + \hat{\beta_{p}X_{p}}\]</span>.</p>
<p><strong>How do we get these parameter estimates?</strong></p>
<p>The parameters are estimated using <em>least squares approach</em> just like in the simple linear regression. The goal is to obtain the set of parameters <span class="math inline">\(\beta_0, \beta_1,..,\beta_p\)</span> that minimize the sum of squared residuals. <span class="math display">\[RSS = \Sigma_{i=1}^{n} (y_{i} - \hat{y_{i}})^2\]</span></p>
<p><strong>Example - multiple linear regression - Advertising data</strong></p>
<p>**Scenario 1 - predict sales using radio</p>
<p>The following code will create a MLR model on the <em>Advertising</em> data set with TV, radio, and newspaper advertising budgets used as predictors to predict product sales.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a><span class="co"># fit a linear model</span></span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a><span class="co">#attach(advertising)</span></span>
<span id="cb23-3"><a href="#cb23-3" aria-hidden="true" tabindex="-1"></a>model_mlr <span class="ot">&lt;-</span> <span class="fu">lm</span>(sales <span class="sc">~</span>newspaper<span class="sc">+</span>TV<span class="sc">+</span>radio, <span class="at">data=</span>advertising)</span>
<span id="cb23-4"><a href="#cb23-4" aria-hidden="true" tabindex="-1"></a><span class="co"># show summary of model</span></span>
<span id="cb23-5"><a href="#cb23-5" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(model_mlr)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
lm(formula = sales ~ newspaper + TV + radio, data = advertising)

Residuals:
    Min      1Q  Median      3Q     Max 
-8.8277 -0.8908  0.2418  1.1893  2.8292 

Coefficients:
             Estimate Std. Error t value Pr(&gt;|t|)    
(Intercept)  2.938889   0.311908   9.422   &lt;2e-16 ***
newspaper   -0.001037   0.005871  -0.177     0.86    
TV           0.045765   0.001395  32.809   &lt;2e-16 ***
radio        0.188530   0.008611  21.893   &lt;2e-16 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Residual standard error: 1.686 on 196 degrees of freedom
Multiple R-squared:  0.8972,    Adjusted R-squared:  0.8956 
F-statistic: 570.3 on 3 and 196 DF,  p-value: &lt; 2.2e-16</code></pre>
</div>
</div>
<p>From the results above, if we were to spend an additional <code>$10,000.00</code> on: - radio advertising budget - while keeping <code>TV</code> and <code>newspaper</code> spend constant, this would result in <code>1885</code> units of additional sales. The <code>newspaper</code> variableâ€™s regression coefficient estimate was non-zero and significant in the single linear regression model above however now it is negative and not significant. <strong>what does this mean?</strong></p>
<p>This highlights the difference between SLR and MLR - in SLR the <em>newspaperâ€™s regression coefficient</em> represents <strong>the average change in product sales</strong> associated with a <strong>$Y change in newspaper advertising budget</strong> ignoring all other predictors.</p>
<p>Whereas in the MLR case, the <em>newspaperâ€™s regression coefficient</em> represents <strong>the average change in product sales associated with a change in newspaper budget</strong> while keeping other variables <strong>FIXED</strong></p>
<p>Does it make sense that SLR says one thing and MLR says another? This is where <strong>colinearity</strong> comes into play.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a><span class="co"># calculate the correlation matrix with R using the pearson 0method</span></span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a>corr_matrix <span class="ot">&lt;-</span> <span class="fu">cor</span>(advertising[,<span class="fu">c</span>(<span class="st">"TV"</span>,<span class="st">"radio"</span>,<span class="st">"newspaper"</span>,<span class="st">"sales"</span>)], <span class="at">method=</span><span class="st">"pearson"</span>)</span>
<span id="cb25-3"><a href="#cb25-3" aria-hidden="true" tabindex="-1"></a><span class="co"># do not show mirrored results</span></span>
<span id="cb25-4"><a href="#cb25-4" aria-hidden="true" tabindex="-1"></a>corr_matrix[<span class="fu">lower.tri</span>(corr_matrix)] <span class="ot">&lt;-</span> <span class="cn">NA</span></span>
<span id="cb25-5"><a href="#cb25-5" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(corr_matrix)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>          TV      radio  newspaper     sales
TV         1 0.05480866 0.05664787 0.7822244
radio     NA 1.00000000 0.35410375 0.5762226
newspaper NA         NA 1.00000000 0.2282990
sales     NA         NA         NA 1.0000000</code></pre>
</div>
</div>
<p>The correlation matrix above shows that radio and newspaper have a correlation of 0.35 - indicating that more or less markets with high newspaper advertising also tend to have high radio advertising. The MLR model says newspaper is not associated with sales but radio is associated with sales. Assuming the MLR model is correct then markets with more spend on radio will show an increase in sales and as the correlation matrix show, these markets also tend to spend more on advertising. This is where <strong>confounding</strong> comes into play - in the SLR model, when we see influence of newspaper on sales - we are ignoring radio but actually radio is the <em>causal factor</em>. Those that spend on <strong>radio</strong> also spend on newspaper.</p>
</section>
<section id="important-considerations-for-multiple-linear-regression" class="level2" data-number="2.2">
<h2 data-number="2.2" class="anchored" data-anchor-id="important-considerations-for-multiple-linear-regression"><span class="header-section-number">2.2</span> Important Considerations for Multiple Linear Regression</h2>
<p>The following section discusses important considerations when performing multiple linear regression.</p>
<section id="is-there-a-relationship-between-response-and-predictors" class="level3" data-number="2.2.1">
<h3 data-number="2.2.1" class="anchored" data-anchor-id="is-there-a-relationship-between-response-and-predictors"><span class="header-section-number">2.2.1</span> Is there a relationship between response and predictors?</h3>
<p>In MLR we need to check whether <span class="math inline">\(\beta_{1}, \beta_{2}, ..., \beta_{p} = 0\)</span>, just like SLR, a <strong>hypothesis test</strong> is used to answer this question.</p>
<p><strong>null hypothesis</strong>: <span class="math display">\[H_{0}:\beta_{1}, \beta_{2}, ..., \beta_{p} = 0 \]</span> <strong>alternative hypothesis</strong> <span class="math display">\[H_{a}: \text{at least one } \beta_{j} \text{ is non-zero}.\]</span> <em>This</em> hypothesis test is performed by calculating the F-Statistic (*why??**) <span class="math display">\[F = \frac{(TSS-RSS)/p}{RSS/(n-p-1)}\]</span></p>
<p>If the <strong>linear model assumptions</strong> are correct, it is possible to show: <span class="math display">\[E\{(RSS/(n-p-1)\} = \sigma^2\]</span> and provided that <span class="math inline">\(H_0\)</span> is true <span class="math display">\[E\{(TSS-RSS)/p\} = \sigma^2\]</span></p>
<p>Hence when there is <strong>NO</strong> relationship between <em>response (Y)</em> and <em>predictors</em>, F-statistic is expected to be close to 1 and if <span class="math inline">\(H_a\)</span> is true, then F is to be greater than 1.However, <em>how large does the F-statistic need to be before we can reject <span class="math inline">\(H_0\)</span> and conclude there is a relationship?</em> This depends on the size of data set (n) and number of predictors (p).</p>
<p>When n is large, an F-statistic that is just above one can still provide evidence of a relationship between the response and variables. In contrast, a larger F-statistic is required to reject null hypothesis when the number of data set observations is small.</p>
</section>
<section id="feature-selection---deciding-on-important-variables" class="level3" data-number="2.2.2">
<h3 data-number="2.2.2" class="anchored" data-anchor-id="feature-selection---deciding-on-important-variables"><span class="header-section-number">2.2.2</span> Feature Selection - deciding on important variables</h3>
<p>Typically, the response is usually associated with a subset of the predictors - variable selection is the task of determining which predictors are associated with the response in order to fit a model with only those predictors. There are three classical approaches for this task: 1. Forward selection 2. Backward selection 3. Mixed selection</p>
</section>
<section id="model-fit" class="level3" data-number="2.2.3">
<h3 data-number="2.2.3" class="anchored" data-anchor-id="model-fit"><span class="header-section-number">2.2.3</span> Model Fit</h3>
<p><strong><span class="math inline">\(R^2\)</span></strong> and <strong>RSE</strong> are the two most common numerical measures for model fit and they are computed the same way as in SLR.<span class="math inline">\(R^2\)</span> is the <em>square of the correlation</em> between the <strong>response</strong> and the <strong>variable</strong>. In MLR, <span class="math inline">\(R^2\)</span> is equal to <span class="math inline">\(Cor(Y,\hat{Y})^2\)</span>, the <em>square of the correlation</em> between <strong>response</strong> and <strong>fitted linear model</strong>. Note that <span class="math inline">\(R^2\)</span> will <strong>always increase</strong> when more variables are added to the models <em>even if those variable have a weak association with the response.</em> <strong>why?</strong> - more variables will result in a decrease in the <code>RSS</code> on the training data.</p>
</section>
<section id="predictions" class="level3" data-number="2.2.4">
<h3 data-number="2.2.4" class="anchored" data-anchor-id="predictions"><span class="header-section-number">2.2.4</span> Predictions</h3>
<p>There are 3 types of uncertainty associated with MLR predictions. 1. Inaccuracy of the parameters - coefficient estimates is related to the reducible error. 2. Model bias - assuming a linear model for <span class="math inline">\(f(X)\)</span> is an approximation of reality - also reducible error. 3. Irreducible error - randomness in the population. Prediction intervals are used to determine the variance between <span class="math inline">\(Y\)</span> and <span class="math inline">\(\hat{Y}\)</span>.</p>
</section>
</section>
<section id="other-considerations-in-regression-model" class="level2" data-number="2.3">
<h2 data-number="2.3" class="anchored" data-anchor-id="other-considerations-in-regression-model"><span class="header-section-number">2.3</span> Other considerations in Regression Model</h2>
<section id="qualitative-predictors" class="level3" data-number="2.3.1">
<h3 data-number="2.3.1" class="anchored" data-anchor-id="qualitative-predictors"><span class="header-section-number">2.3.1</span> Qualitative predictors</h3>
<p>Quantitative data has been used so far for regression models, however in practice often predictors are also qualitative.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a><span class="co"># assign Credit to a variable -  credit</span></span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a>credit <span class="ot">&lt;-</span> Credit</span>
<span id="cb27-3"><a href="#cb27-3" aria-hidden="true" tabindex="-1"></a><span class="co"># show first 6 observations </span></span>
<span id="cb27-4"><a href="#cb27-4" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(credit)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>   Income Limit Rating Cards Age Education Own Student Married Region Balance
1  14.891  3606    283     2  34        11  No      No     Yes  South     333
2 106.025  6645    483     3  82        15 Yes     Yes     Yes   West     903
3 104.593  7075    514     4  71        11  No      No      No   West     580
4 148.924  9504    681     3  36        11 Yes      No      No   West     964
5  55.882  4897    357     2  68        16  No      No     Yes  South     331
6  80.180  8047    569     4  77        10  No      No      No  South    1151</code></pre>
</div>
</div>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a><span class="co"># create a pairwise plot</span></span>
<span id="cb29-2"><a href="#cb29-2" aria-hidden="true" tabindex="-1"></a><span class="fu">pairs</span>(credit)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="c3_lab_linear_regression_files/figure-html/unnamed-chunk-21-1.png" class="img-fluid" width="768"></p>
</div>
</div>
<section id="predictors-with-only-2-levels" class="level4" data-number="2.3.1.1">
<h4 data-number="2.3.1.1" class="anchored" data-anchor-id="predictors-with-only-2-levels"><span class="header-section-number">2.3.1.1</span> Predictors with only 2 levels</h4>
<p>Using the <code>credit</code> data set, let us investigate the difference sin credit card balance between those who own a house and those who do not. Ownership is a <em>factor</em> or <em>qualitative predictor</em> with only two <em>levels</em> and using this just requires creating a <em>numerical</em> variable with only two possible values. This is known as <strong>one-hot encoding</strong> in machine learning.</p>
<p><span class="math display">\[
x_{i} =
\begin{cases}
1 &amp; \text{if } i_{th} \text{ person owns a house.}\\
0 &amp; \text{if } i_{th} \text{ person does not own a house}
\end{cases}
\]</span></p>
<p>Using the above definition, the regression model equation takes on the form</p>
<p><span class="math display">\[
x_{i} = \beta_{0} + \beta_{1}x_{i}+ \epsilon_{i}
\begin{cases}
\beta_{0} + \beta_{1}x_{i}+ \epsilon_{i} &amp; \text{if } i_{th} \text{ person owns a house.}\\
\beta_{0} + \epsilon_{i} &amp; \text{if } i_{th} \text{ person does not own a house}
\end{cases}
\]</span></p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a>model_house <span class="ot">&lt;-</span> <span class="fu">lm</span>(Balance <span class="sc">~</span>Own, <span class="at">data=</span>credit)</span>
<span id="cb30-2"><a href="#cb30-2" aria-hidden="true" tabindex="-1"></a><span class="co"># show summary of model</span></span>
<span id="cb30-3"><a href="#cb30-3" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(model_house)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
lm(formula = Balance ~ Own, data = credit)

Residuals:
    Min      1Q  Median      3Q     Max 
-529.54 -455.35  -60.17  334.71 1489.20 

Coefficients:
            Estimate Std. Error t value Pr(&gt;|t|)    
(Intercept)   509.80      33.13  15.389   &lt;2e-16 ***
OwnYes         19.73      46.05   0.429    0.669    
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Residual standard error: 460.2 on 398 degrees of freedom
Multiple R-squared:  0.0004611, Adjusted R-squared:  -0.00205 
F-statistic: 0.1836 on 1 and 398 DF,  p-value: 0.6685</code></pre>
</div>
</div>
<p>Notice the high <em>p-value</em> for the dummy variable, this suggests that there is no statistical evidence of a difference in average credit card balance based on house ownership.</p>
</section>
</section>
<section id="extensions-of-linear-model" class="level3" data-number="2.3.2">
<h3 data-number="2.3.2" class="anchored" data-anchor-id="extensions-of-linear-model"><span class="header-section-number">2.3.2</span> Extensions of Linear Model</h3>
<p>The linear regression model makes several highly restrictive assumptions that are violated <strong>in practice</strong>. The 2 most important assumptions state that the relationship between predictors and response are <strong>additive and linear.</strong></p>
<ol type="1">
<li><p>The <strong>additive</strong> assumption means that associations between a predictor <span class="math inline">\(X_j\)</span> and the response <span class="math inline">\(Y\)</span> <strong>does not depend on the values of other predictors.</strong> - confounding variables.</p></li>
<li><p>The <strong>linearity</strong> assumption states that a <span class="math inline">\(\delta\)</span> in <span class="math inline">\(Y\)</span> associated with a <strong>one-unit change</strong> in <span class="math inline">\(X_j\)</span> is constant, regardless of the value of <span class="math inline">\(X_j\)</span>.</p></li>
</ol>
<p>However, in practice the <em>additive</em> assumption is violated by the occurrence of a <em>synergy effect</em> or <em>interaction effect</em> - which occur where a change in one of the predictors influences another predictor. For example in the <em>Advertising</em> data set, an increase in budget for radio advertising increases the effectiveness of TV advertising - therefore as the slope term <span class="math inline">\(\beta_{TV}\)</span> should have a positive correlation with <span class="math inline">\(\beta_{radio}\)</span>.</p>
<p>Considering the standard linear regression model with two variables: <span class="math display">\[Y = \beta_{0} + \beta_{1}X_{1} + \beta_{2}X_{2} + \epsilon\]</span> a <strong>one-unit increase</strong> in <span class="math inline">\(X_{1}\)</span> is associated with an <strong>average increase in Y</strong> of <span class="math inline">\(\beta_{1}\)</span> units. This model is extended when including the <em>interaction effect</em> - product of <span class="math inline">\(X_{1}\)</span> and <span class="math inline">\(X_{2}\)</span>. The extended model is then: <span class="math display">\[Y = \beta_{0} + \beta_{1}X_{1} + \beta_{2}X_{2} + \beta_{3}X_{1}X_{2} + \epsilon \\
Y = \beta_{0} + (\beta_{1} + \beta_{3}X_{2})X_{1} + \beta_{2}X_{2}  + \epsilon\]</span></p>
<p>** Interaction effect with advertising data**</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb32"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a><span class="co"># fit a linear model</span></span>
<span id="cb32-2"><a href="#cb32-2" aria-hidden="true" tabindex="-1"></a><span class="co">#attach(advertising)</span></span>
<span id="cb32-3"><a href="#cb32-3" aria-hidden="true" tabindex="-1"></a><span class="co"># fit model with interaction effect</span></span>
<span id="cb32-4"><a href="#cb32-4" aria-hidden="true" tabindex="-1"></a>model_mlr_int <span class="ot">&lt;-</span> <span class="fu">lm</span>(sales <span class="sc">~</span> TV<span class="sc">+</span>radio <span class="sc">+</span>(TV<span class="sc">*</span>radio), <span class="at">data=</span>advertising)</span>
<span id="cb32-5"><a href="#cb32-5" aria-hidden="true" tabindex="-1"></a><span class="co"># show summary of model</span></span>
<span id="cb32-6"><a href="#cb32-6" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(model_mlr_int)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
lm(formula = sales ~ TV + radio + (TV * radio), data = advertising)

Residuals:
    Min      1Q  Median      3Q     Max 
-6.3366 -0.4028  0.1831  0.5948  1.5246 

Coefficients:
             Estimate Std. Error t value Pr(&gt;|t|)    
(Intercept) 6.750e+00  2.479e-01  27.233   &lt;2e-16 ***
TV          1.910e-02  1.504e-03  12.699   &lt;2e-16 ***
radio       2.886e-02  8.905e-03   3.241   0.0014 ** 
TV:radio    1.086e-03  5.242e-05  20.727   &lt;2e-16 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Residual standard error: 0.9435 on 196 degrees of freedom
Multiple R-squared:  0.9678,    Adjusted R-squared:  0.9673 
F-statistic:  1963 on 3 and 196 DF,  p-value: &lt; 2.2e-16</code></pre>
</div>
</div>
<p>The linear model for the above is: <span class="math display">\[Y = \beta_{0} + \beta_{1}\times TV + \beta_{2} \times radio + \beta_{3} \times (radio \times TV) + \epsilon \\
Y = \beta_{0} + (\beta_{1} + \beta_{3} \times radio)\times TV + \beta_{2} \times radio  + \epsilon
\]</span></p>
<p>The slope for the interaction effect can be be interpreted as the increase in the effectiveness of TV advertising associated with a one-unit increase in radio advertising (or vice-versa). The <em>p-values</em> from the model above will give indication of the validity of the interaction effect - a high p-value would indicate that we should reconsider if there is an interaction effect between the selected variables. A low p-value for the interaction term would indicate that there is <em>strong evidence</em> for <span class="math inline">\(H_{a}: \beta_{3} \neq 0\)</span>. Therefore the <strong>true relationship is not additive.</strong></p>
<p>From the summary above - an increase in TV advertising of 500 is associated with increased sales of <span class="math inline">\((\hat{\beta_{1}} + \hat{\beta_{3}} \times radio) \times 500 = 19.1+ 1.086 \times radio\)</span> units.</p>
<p><strong>Note</strong> - if the interaction effect has a small p-value and the but the associated <em>main effects</em> do not, based on the <strong>hierarchiacal pricniple</strong> they should be included in the model even though they are not significant.</p>
<p><strong>questions</strong> 1. Can an interaction effect occur between more than two predictors?</p>
</section>
</section>
</section>

<div id="quarto-appendix" class="default"><section class="quarto-appendix-contents"><h2 class="anchored quarto-appendix-heading">Reuse</h2><div id="quarto-reuse" class="quarto-appendix-contents"><div><a rel="license" href="https://creativecommons.org/licenses/by/4.0/">https://creativecommons.org/licenses/by/4.0/</a></div></div></section></div></main>
<!-- /main column -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "î§‹";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->



</body></html>